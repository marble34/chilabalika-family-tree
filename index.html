<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#667eea">
    <title>Chilabalika Family Tree</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-attachment: fixed;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }

        /* Animated Background Canvas */
        #background-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        /* Password Screen Styles */
        #password-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            transition: opacity 0.8s ease-out;
        }

        #password-screen.fade-out {
            opacity: 0;
        }

        .password-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 50px 60px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 450px;
            width: 90%;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .password-header svg {
            stroke: #667eea;
            margin-bottom: 20px;
        }

        .password-header h1 {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 32px;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .password-header p {
            color: #6b7280;
            font-size: 16px;
            margin-bottom: 30px;
        }

        .password-form input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 16px;
            margin-bottom: 15px;
            transition: all 0.3s;
            font-family: 'Inter', sans-serif;
        }

        .password-form input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .password-form button {
            width: 100%;
            padding: 16px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .password-form button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .password-error {
            color: #ef4444;
            font-size: 14px;
            margin-top: 10px;
            min-height: 20px;
        }

        .password-footer {
            margin-top: 30px;
            padding-top: 25px;
            border-top: 1px solid #e5e7eb;
        }

        .password-footer p {
            color: #9ca3af;
            font-size: 13px;
            margin: 0;
        }

        #main-content {
            width: 100vw;
            height: 100vh;
        }

        /* Welcome Screen Styles */
        #welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            transition: opacity 1s ease-in;
        }

        #welcome-screen.active {
            opacity: 1;
        }

        #welcome-screen.fade-out {
            opacity: 0;
            transition: opacity 1.5s ease-out;
        }

        .welcome-content {
            text-align: center;
            color: white;
            z-index: 2;
        }

        .welcome-animation {
            animation: welcomeFloat 3s ease-in-out;
        }

        @keyframes welcomeFloat {
            0% {
                opacity: 0;
                transform: translateY(30px);
            }
            50% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .welcome-title {
            font-family: 'Outfit', sans-serif;
            font-size: 48px;
            font-weight: 300;
            margin: 0;
            letter-spacing: 2px;
            text-shadow: 0 4px 20px rgba(0,0,0,0.2);
            animation: fadeInUp 1s ease-out;
        }

        .welcome-subtitle {
            font-family: 'Outfit', sans-serif;
            font-size: 72px;
            font-weight: 700;
            margin: 10px 0 20px 0;
            letter-spacing: 1px;
            text-shadow: 0 6px 30px rgba(0,0,0,0.3);
            background: linear-gradient(135deg, #ffffff 0%, #f0d9ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: fadeInUp 1.2s ease-out;
        }

        .welcome-tagline {
            font-family: 'Inter', sans-serif;
            font-size: 20px;
            font-weight: 300;
            margin: 0 0 40px 0;
            opacity: 0.95;
            letter-spacing: 3px;
            text-transform: uppercase;
            animation: fadeInUp 1.4s ease-out;
        }

        .welcome-ornament {
            margin-top: 40px;
            animation: fadeInRotate 2s ease-out;
        }

        .welcome-ornament svg {
            color: white;
            filter: drop-shadow(0 4px 10px rgba(0,0,0,0.2));
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInRotate {
            from {
                opacity: 0;
                transform: scale(0.5) rotate(-180deg);
            }
            to {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.05);
                opacity: 0.8;
            }
        }

        .welcome-ornament svg circle {
            animation: pulse 3s ease-in-out infinite;
        }

        /* ========================================
           MOBILE OPTIMIZATIONS
           ======================================== */

        @media (max-width: 768px) {
            /* Password Screen Mobile */
            .password-container {
                padding: 30px 25px;
                width: 85%;
                max-width: 100%;
            }

            .password-header h1 {
                font-size: 24px;
            }

            .password-header p {
                font-size: 14px;
            }

            .password-header svg {
                width: 50px;
                height: 50px;
            }

            .password-form input,
            .password-form button {
                padding: 14px 18px;
                font-size: 16px; /* Prevents zoom on iOS */
            }

            /* Welcome Screen Mobile */
            .welcome-title {
                font-size: 28px;
                letter-spacing: 1px;
            }

            .welcome-subtitle {
                font-size: 38px;
                margin: 10px 0 15px 0;
            }

            .welcome-tagline {
                font-size: 14px;
                letter-spacing: 2px;
            }

            .welcome-ornament {
                margin-top: 30px;
            }

            .welcome-ornament svg {
                width: 80px;
                height: 80px;
            }

            /* Navigation Mobile */
            #nav-bar {
                padding: 12px 15px;
                flex-direction: column;
                gap: 10px;
            }

            .nav-toggle {
                width: 100%;
                justify-content: center;
            }

            .nav-btn {
                padding: 10px 20px;
                font-size: 13px;
            }

            /* Sidebar Mobile - Starts Collapsed */
            .sidebar-controls {
                width: 60px;
                padding: 12px;
                left: 10px;
                top: 10px;
            }

            /* Force collapsed state on mobile */
            .sidebar-controls:not(.collapsed) {
                width: 60px;
            }

            .sidebar-controls .btn-text,
            .sidebar-controls .label-text,
            .sidebar-controls .control-divider {
                display: none;
            }

            .sidebar-controls .sidebar-btn {
                justify-content: center;
                padding: 12px;
            }

            .sidebar-controls .control-section h3 {
                text-align: center;
            }

            .sidebar-toggle {
                padding: 10px;
            }

            /* Search Box Mobile */
            .search-box {
                width: calc(100% - 90px);
                max-width: 300px;
                padding: 10px 15px;
                top: 20px;
            }

            .search-box input {
                font-size: 16px; /* Prevents zoom on iOS */
                padding: 8px 10px;
            }

            .search-suggestions {
                font-size: 14px;
            }

            .suggestion-item {
                padding: 12px 15px;
            }

            /* Legend Mobile - Collapsible */
            .legend {
                bottom: 15px;
                left: 15px;
                padding: 12px 15px;
                font-size: 12px;
                max-width: calc(100% - 30px);
            }

            .legend.collapsed-mobile .widget-content {
                display: none;
            }

            .legend.collapsed-mobile {
                padding: 8px 12px;
                min-width: auto;
            }

            .legend .widget-toggle {
                display: flex;
            }

            .legend.collapsed-mobile h3 {
                display: inline-block;
                margin: 0;
                font-size: 12px;
                padding-right: 35px;
            }

            .legend:not(.collapsed-mobile) h3 {
                margin-bottom: 10px;
            }

            .collapsed-mobile .chevron-up {
                display: block;
            }

            .collapsed-mobile .chevron-down {
                display: none !important;
            }

            :not(.collapsed-mobile) .chevron-up {
                display: none !important;
            }

            :not(.collapsed-mobile) .chevron-down {
                display: block !important;
            }

            .legend h3 {
                font-size: 14px;
                margin-bottom: 10px;
            }

            .legend-item {
                gap: 8px;
                margin: 8px 0;
                font-size: 12px;
            }

            .legend-color {
                width: 14px;
                height: 14px;
            }

            /* Stats Mobile - Collapsible */
            #stats {
                bottom: 15px;
                right: 15px;
                padding: 12px 15px;
                max-width: calc(50% - 20px);
            }

            #stats.collapsed-mobile .widget-content {
                display: none;
            }

            #stats.collapsed-mobile {
                padding: 8px 12px;
                min-width: auto;
            }

            #stats .widget-toggle {
                display: flex;
            }

            #stats.collapsed-mobile .label {
                display: inline;
                font-size: 11px;
            }

            #stats .stat {
                font-size: 11px;
                margin: 4px 0;
            }

            #stats .number {
                font-size: 18px;
            }

            #stats .label {
                font-size: 11px;
            }

            /* Info Panel Mobile */
            #info-panel {
                top: auto;
                bottom: 20px;
                right: 15px;
                left: 15px;
                max-width: none;
                padding: 20px;
            }

            #info-panel h2 {
                font-size: 18px;
            }

            #info-panel p {
                font-size: 13px;
            }

            /* Tree Nodes Mobile - Larger touch targets */
            .node circle {
                stroke-width: 4px;
            }

            .node.patriarch circle {
                stroke-width: 5px;
            }

            .node text {
                font-size: 12px;
            }

            /* Content Cards Mobile */
            .content-card {
                padding: 25px 15px;
                overflow-x: hidden;
            }

            .content-card h1 {
                font-size: 28px;
                word-wrap: break-word;
            }

            .content-card h2 {
                font-size: 22px;
                word-wrap: break-word;
            }

            .content-card .intro {
                font-size: 15px;
            }

            .content-card p,
            .content-card li {
                word-wrap: break-word;
                overflow-wrap: break-word;
            }

            /* Fix all images and media */
            .content-card img,
            .content-card svg,
            .reunion-photo img {
                max-width: 100%;
                height: auto;
            }

            /* Reunion Photo Mobile */
            .reunion-photo img {
                border-radius: 12px;
            }

            /* Benefits Grid Mobile */
            .benefits-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .benefit-item {
                padding: 20px 18px;
            }

            /* Contact Grid Mobile */
            .contact-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            /* Page Content Mobile */
            .page-content {
                padding: 30px 15px;
            }

            /* Reunion Highlights Mobile */
            .past-reunion-highlight,
            .next-reunion-cta {
                padding: 25px 20px;
            }

            .past-reunion-highlight h2,
            .next-reunion-cta h3 {
                font-size: 22px;
            }

            /* Reduce particle count on mobile for performance */
            #background-canvas {
                opacity: 0.7;
            }
        }

        @media (max-width: 480px) {
            /* Extra small phones */
            .welcome-title {
                font-size: 22px;
            }

            .welcome-subtitle {
                font-size: 32px;
            }

            .welcome-tagline {
                font-size: 12px;
            }

            .password-container {
                padding: 25px 20px;
            }

            .search-box {
                width: calc(100% - 80px);
            }

            /* Stack legend and stats vertically on very small screens */
            .legend,
            #stats {
                position: relative;
                margin: 10px;
                display: inline-block;
            }
        }

        /* Touch-specific optimizations */
        @media (hover: none) and (pointer: coarse) {
            /* This targets touch devices */
            .sidebar-btn,
            .nav-btn,
            button,
            .suggestion-item {
                min-height: 44px; /* iOS recommendation for touch targets */
            }

            /* Disable hover effects on touch devices */
            .node:hover circle {
                stroke: inherit;
                stroke-width: inherit;
                transform: none;
            }

            /* Make scrolling smoother on iOS */
            .search-suggestions,
            .sidebar-controls {
                -webkit-overflow-scrolling: touch;
            }
        }

        /* Landscape mode on mobile */
        @media (max-width: 896px) and (orientation: landscape) {
            .sidebar-controls {
                max-height: calc(100vh - 80px);
            }

            #info-panel {
                max-height: 60vh;
                overflow-y: auto;
            }

            .welcome-title {
                font-size: 24px;
            }

            .welcome-subtitle {
                font-size: 36px;
            }
        }

        #container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        #nav-bar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding: 16px 40px;
            display: flex;
            justify-content: center;
        }

        .sidebar-controls {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 240px;
            max-height: calc(100vh - 120px);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.95) 0%, rgba(118, 75, 162, 0.95) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 1000;
            overflow-y: auto;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sidebar-controls.collapsed {
            width: 70px;
            padding: 15px;
        }

        .sidebar-controls.collapsed .btn-text,
        .sidebar-controls.collapsed .label-text,
        .sidebar-controls.collapsed .control-divider {
            display: none;
        }

        .sidebar-controls.collapsed .sidebar-btn {
            justify-content: center;
            padding: 14px;
        }

        .sidebar-controls.collapsed .control-section h3 {
            text-align: center;
        }

        .sidebar-toggle {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-bottom: 15px;
            box-shadow: none;
        }

        .sidebar-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .sidebar-toggle svg {
            width: 16px;
            height: 16px;
            transition: transform 0.3s;
        }

        .sidebar-controls.collapsed .icon-expand {
            display: block;
        }

        .sidebar-controls.collapsed .icon-collapse {
            display: none;
        }

        .sidebar-controls:not(.collapsed) .icon-expand {
            display: none;
        }

        .sidebar-controls:not(.collapsed) .icon-collapse {
            display: block;
        }

        .sidebar-controls::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar-controls::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .sidebar-controls::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }

        .sidebar-controls::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .control-section {
            margin-bottom: 12px;
        }

        .control-section:last-child {
            margin-bottom: 0;
        }

        .control-section h3 {
            font-family: 'Outfit', sans-serif;
            font-size: 11px;
            font-weight: 700;
            color: #ffffff;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
            opacity: 0.9;
        }

        .sidebar-btn {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: left;
            white-space: nowrap;
            overflow: visible;
        }

        .sidebar-btn:last-child {
            margin-bottom: 0;
        }

        .sidebar-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .sidebar-btn.active {
            background: #ffffff;
            color: #667eea;
            border-color: #ffffff;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .sidebar-btn.active:hover {
            transform: translateX(4px);
        }

        .sidebar-btn svg {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.1));
        }

        .control-section h3 {
            font-family: 'Outfit', sans-serif;
            font-size: 11px;
            font-weight: 700;
            color: #ffffff;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
            text-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .control-divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.2);
            margin: 16px 0;
        }

        .nav-toggle {
            display: flex;
            gap: 8px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 6px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .nav-btn {
            padding: 10px 28px;
            background: transparent;
            color: rgba(255, 255, 255, 0.7);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: none;
        }

        .nav-btn:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
            transform: none;
            box-shadow: none;
        }

        .nav-btn.active {
            background: white;
            color: #667eea;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .nav-btn.active:hover {
            background: white;
            transform: none;
        }

        #toolbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 20px 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        #toolbar h1 {
            font-family: 'Outfit', sans-serif;
            font-size: 26px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-right: auto;
            font-weight: 700;
        }

        #toolbar .subtitle {
            color: #6b7280;
            font-size: 13px;
            margin-left: -10px;
            font-weight: 400;
        }

        button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        #svg-container {
            flex: 1;
            position: relative;
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(10px);
            overflow: auto;
            -webkit-overflow-scrolling: touch;
        }

        .content-section {
            display: none;
            flex: 1;
            overflow: auto;
        }

        .content-section.active {
            display: flex;
            flex-direction: column;
        }

        .page-content {
            flex: 1;
            padding: 60px 40px;
            overflow-y: auto;
        }

        .content-card {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 50px 60px;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .content-card h1 {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 42px;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .content-card h2 {
            font-family: 'Outfit', sans-serif;
            color: #1f2937;
            font-size: 28px;
            margin-top: 35px;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .content-card .intro {
            font-size: 18px;
            color: #6b7280;
            line-height: 1.8;
            margin-bottom: 30px;
        }

        .content-card p {
            font-size: 16px;
            line-height: 1.8;
            color: #4b5563;
            margin-bottom: 15px;
        }

        .content-card ul {
            margin: 15px 0 25px 25px;
            line-height: 1.8;
        }

        .content-card li {
            margin-bottom: 10px;
            color: #4b5563;
        }

        .content-card blockquote {
            border-left: 4px solid #667eea;
            padding: 20px 30px;
            margin: 30px 0;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
            font-family: 'Outfit', sans-serif;
            font-size: 18px;
            font-style: italic;
            color: #1f2937;
            border-radius: 12px;
        }

        svg {
            width: 100%;
            height: 100%;
        }

        .link {
            fill: none;
            stroke: #cbd5e1;
            stroke-width: 2px;
            opacity: 0.6;
        }

        .marriage-link {
            stroke: #f093fb;
            stroke-width: 2.5px;
            stroke-dasharray: 6,4;
            opacity: 0.8;
        }

        .node circle {
            stroke: #fff;
            stroke-width: 3px;
            cursor: pointer;
            transition: all 0.3s;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.15));
        }

        .node.male circle {
            fill: #667eea;
        }

        .node.female circle {
            fill: #f093fb;
        }

        .node.unknown circle {
            fill: #a78bfa;
        }

        .node.patriarch circle {
            fill: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            stroke: white;
            stroke-width: 4px;
            filter: drop-shadow(0 6px 12px rgba(102, 126, 234, 0.4));
        }

        .node text {
            font-size: 11px;
            pointer-events: none;
            font-weight: 500;
            fill: #1f2937;
        }

        .node.patriarch text {
            font-family: 'Outfit', sans-serif;
            font-size: 18px;
            font-weight: 700;
            fill: #667eea;
        }

        .node:hover circle {
            stroke: #667eea;
            stroke-width: 4px;
            transform: scale(1.15);
        }

        #info-panel {
            position: absolute;
            top: 30px;
            right: 30px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            max-width: 350px;
            display: none;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        #info-panel.active {
            display: block;
            animation: slideIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }

        #info-panel h2 {
            font-family: 'Outfit', sans-serif;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 22px;
        }

        #info-panel p {
            margin: 10px 0;
            color: #6b7280;
            line-height: 1.8;
            font-size: 14px;
        }

        #info-panel .label {
            font-weight: 600;
            color: #1f2937;
            display: inline-block;
            min-width: 90px;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            padding: 0;
            font-size: 18px;
            line-height: 1;
            cursor: pointer;
        }

        .close-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.4);
        }

        .legend {
            position: absolute;
            bottom: 30px;
            left: 30px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 20px 25px;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            border: 1px solid rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
        }

        .widget-toggle {
            display: none; /* Hidden on desktop */
            position: absolute;
            top: 10px;
            right: 10px;
            width: 28px;
            height: 28px;
            padding: 0;
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 6px;
            cursor: pointer;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .widget-toggle:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: none;
            box-shadow: none;
        }

        .widget-content {
            transition: all 0.3s ease;
        }

        .legend h3 {
            font-family: 'Outfit', sans-serif;
            margin-bottom: 15px;
            color: #1f2937;
            font-size: 16px;
            font-weight: 600;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 10px 0;
        }

        .legend-color {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .controls {
            position: absolute;
            top: 30px;
            left: 30px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .zoom-btn {
            width: 50px;
            height: 50px;
            padding: 0;
            font-size: 24px;
            line-height: 1;
            border-radius: 50%;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }

        .search-box {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 12px 20px;
            border-radius: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            border: 1px solid rgba(255, 255, 255, 0.5);
            width: 350px;
            z-index: 999;
        }

        .search-box input {
            border: none;
            padding: 8px 12px;
            width: 100%;
            font-size: 14px;
            background: transparent;
            color: #1f2937;
        }

        .search-box input::placeholder {
            color: #9ca3af;
        }

        .search-box input:focus {
            outline: none;
        }

        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 8px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
        }

        .search-suggestions.active {
            display: block;
        }

        .suggestion-item {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
            transition: background 0.2s;
            font-size: 14px;
            color: #1f2937;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-item:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .suggestion-item .match-highlight {
            font-weight: 700;
            color: #667eea;
        }

        .search-message {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-top: 12px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            font-size: 13px;
            color: #6b7280;
            display: none;
            white-space: nowrap;
        }

        .search-message.active {
            display: block;
        }

        .search-message.no-results {
            color: #ef4444;
        }

        .search-suggestions::-webkit-scrollbar {
            width: 6px;
        }

        .search-suggestions::-webkit-scrollbar-track {
            background: #f3f4f6;
            border-radius: 10px;
        }

        .search-suggestions::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 10px;
        }

        .search-suggestions::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }

        #stats {
            position: absolute;
            bottom: 30px;
            right: 30px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 20px 25px;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        #stats .stat {
            margin: 8px 0;
            font-size: 14px;
            color: #6b7280;
        }

        #stats .label {
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            color: #1f2937;
        }

        #stats .number {
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 28px;
        }

        .reunion-highlight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 35px 40px;
            border-radius: 20px;
            margin: 30px 0;
            text-align: center;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
        }

        .past-reunion-highlight {
            background: linear-gradient(135deg, rgba(107, 114, 128, 0.1) 0%, rgba(156, 163, 175, 0.1) 100%);
            color: #4b5563;
            padding: 30px 35px;
            border-radius: 20px;
            margin: 30px 0;
            text-align: center;
            border: 2px solid rgba(107, 114, 128, 0.2);
        }

        .past-reunion-highlight h2 {
            color: #6b7280;
            margin-top: 0;
            font-size: 28px;
        }

        .past-reunion-highlight p {
            color: #6b7280;
            margin-bottom: 10px;
        }

        .date-badge-past {
            display: inline-block;
            background: #e5e7eb;
            color: #6b7280;
            padding: 8px 24px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 16px;
            margin: 15px 0;
            letter-spacing: 1px;
        }

        .next-reunion-cta {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 35px 40px;
            border-radius: 20px;
            margin: 30px 0;
            text-align: center;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
            color: white;
        }

        .next-reunion-cta h3 {
            color: white;
            font-size: 26px;
            margin-top: 0;
            margin-bottom: 15px;
        }

        .next-reunion-cta p {
            color: rgba(255, 255, 255, 0.95);
            font-size: 16px;
            margin-bottom: 20px;
        }

        .cta-button {
            background: white;
            color: #667eea;
            padding: 12px 32px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 16px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .reunion-photo {
            margin: 30px 0;
        }

        .reunion-photo img {
            filter: grayscale(10%);
            transition: all 0.3s;
        }

        .reunion-photo img:hover {
            filter: grayscale(0%);
            transform: scale(1.01);
        }

        .photo-caption {
            text-align: center;
            font-style: italic;
            color: #6b7280;
            margin-top: 15px;
            font-size: 14px;
        }

        .reunion-highlight h2 {
            color: white;
            margin-top: 0;
            font-size: 32px;
        }

        .reunion-highlight p {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 10px;
        }

        .date-badge {
            display: inline-block;
            background: white;
            color: #667eea;
            padding: 8px 24px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 16px;
            margin: 15px 0;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .benefit-item {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(240, 147, 251, 0.05) 100%);
            padding: 30px 25px;
            border-radius: 16px;
            border: 1px solid rgba(102, 126, 234, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .benefit-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.15);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .benefit-icon {
            font-size: 36px;
            display: block;
            margin-bottom: 15px;
        }

        .benefit-item h3 {
            font-family: 'Outfit', sans-serif;
            color: #1f2937;
            font-size: 18px;
            margin-bottom: 10px;
            margin-top: 0;
            font-weight: 600;
        }

        .benefit-item p {
            font-size: 14px;
            color: #6b7280;
            margin: 0;
        }

        .contact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .contact-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(240, 147, 251, 0.05) 100%);
            padding: 25px;
            border-radius: 16px;
            border: 1px solid rgba(102, 126, 234, 0.1);
            transition: all 0.3s;
        }

        .contact-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.15);
        }

        .contact-card h3 {
            font-family: 'Outfit', sans-serif;
            color: #1f2937;
            font-size: 20px;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .contact-card p {
            font-size: 14px;
            margin-bottom: 8px;
        }

        .contact-card strong {
            color: #667eea;
            font-weight: 600;
        }

        .cta-section {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(240, 147, 251, 0.1) 100%);
            padding: 30px 35px;
            border-radius: 16px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            margin-top: 40px;
        }

        .cta-section h3 {
            font-family: 'Outfit', sans-serif;
            color: #1f2937;
            font-size: 24px;
            margin-top: 0;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .cta-section p {
            margin-bottom: 10px;
        }

        .footer-note {
            margin-top: 40px;
            padding-top: 25px;
            border-top: 2px solid rgba(102, 126, 234, 0.1);
            text-align: center;
            font-style: italic;
            color: #9ca3af;
        }

        #container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        #nav-bar {
            background: #1a0f2e;
            padding: 12px 30px;
            display: flex;
            justify-content: center;
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
        }

        .nav-toggle {
            display: flex;
            gap: 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 4px;
        }

        .nav-btn {
            padding: 10px 28px;
            background: transparent;
            color: rgba(255, 255, 255, 0.6);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            box-shadow: none;
        }

        .nav-btn:hover {
            color: rgba(255, 255, 255, 0.9);
            background: rgba(255, 255, 255, 0.08);
            transform: none;
            box-shadow: none;
        }

        .nav-btn.active {
            background: #d4af37;
            color: #1a0f2e;
            box-shadow: 0 2px 8px rgba(212, 175, 55, 0.3);
        }

        .nav-btn.active:hover {
            background: #f0d062;
            transform: none;
        }

        #toolbar {
            background: linear-gradient(135deg, #2d1b4e 0%, #4a2c6f 100%);
            padding: 20px 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            border-bottom: 3px solid #d4af37;
        }

        #toolbar h1 {
            font-family: 'Crimson Pro', serif;
            font-size: 28px;
            color: #d4af37;
            margin-right: auto;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        #toolbar .subtitle {
            color: rgba(255,255,255,0.9);
            font-size: 14px;
            margin-left: -10px;
            font-weight: 300;
        }

        button {
            padding: 10px 20px;
            background: #d4af37;
            color: #2d1b4e;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(212, 175, 55, 0.3);
        }

        button:hover {
            background: #f0d062;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.4);
        }

        .view-switcher {
            display: flex;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            padding: 6px;
            border-radius: 8px;
            margin-left: auto;
            margin-right: 20px;
        }

        .view-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: transparent;
            color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 13px;
        }

        .view-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-color: rgba(255, 255, 255, 0.3);
            transform: none;
        }

        .view-btn.active {
            background: #d4af37;
            color: #2d1b4e;
            border-color: #d4af37;
        }

        .view-btn.active:hover {
            background: #f0d062;
            transform: translateY(-2px);
        }

        .view-btn svg {
            width: 18px;
            height: 18px;
        }

        #svg-container {
            flex: 1;
            position: relative;
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
        }

        .content-section {
            display: none;
            flex: 1;
            overflow: auto;
        }

        .content-section.active {
            display: flex;
            flex-direction: column;
        }

        .page-content {
            flex: 1;
            padding: 60px 40px;
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            overflow-y: auto;
        }

        .content-card {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 50px 60px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .content-card h1 {
            font-family: 'Crimson Pro', serif;
            color: #2d1b4e;
            font-size: 42px;
            margin-bottom: 20px;
            border-bottom: 3px solid #d4af37;
            padding-bottom: 15px;
        }

        .content-card h2 {
            font-family: 'Crimson Pro', serif;
            color: #2d1b4e;
            font-size: 28px;
            margin-top: 35px;
            margin-bottom: 15px;
        }

        .content-card .intro {
            font-size: 18px;
            color: #555;
            line-height: 1.8;
            margin-bottom: 30px;
        }

        .content-card p {
            font-size: 16px;
            line-height: 1.8;
            color: #444;
            margin-bottom: 15px;
        }

        .content-card ul {
            margin: 15px 0 25px 25px;
            line-height: 1.8;
        }

        .content-card li {
            margin-bottom: 10px;
            color: #444;
        }

        .content-card blockquote {
            border-left: 4px solid #d4af37;
            padding: 20px 30px;
            margin: 30px 0;
            background: #f9f9f9;
            font-family: 'Crimson Pro', serif;
            font-size: 18px;
            font-style: italic;
            color: #2d1b4e;
        }

        .contact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .contact-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
            padding: 25px;
            border-radius: 12px;
            border-left: 4px solid #d4af37;
        }

        .contact-card h3 {
            font-family: 'Crimson Pro', serif;
            color: #2d1b4e;
            font-size: 20px;
            margin-bottom: 12px;
        }

        .contact-card p {
            font-size: 14px;
            margin-bottom: 8px;
        }

        .contact-card strong {
            color: #d4af37;
            font-weight: 600;
        }

        .footer-note {
            margin-top: 40px;
            padding-top: 25px;
            border-top: 2px solid #e0e0e0;
            text-align: center;
            font-style: italic;
            color: #777;
        }

        .reunion-highlight {
            background: linear-gradient(135deg, #2d1b4e 0%, #4a2c6f 100%);
            color: white;
            padding: 35px 40px;
            border-radius: 12px;
            margin: 30px 0;
            text-align: center;
        }

        .reunion-highlight h2 {
            color: #d4af37;
            margin-top: 0;
            font-size: 32px;
        }

        .reunion-highlight p {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 10px;
        }

        .date-badge {
            display: inline-block;
            background: #d4af37;
            color: #2d1b4e;
            padding: 8px 24px;
            border-radius: 6px;
            font-weight: 700;
            font-size: 16px;
            margin: 15px 0;
            letter-spacing: 1px;
        }

        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .benefit-item {
            background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
            padding: 30px 25px;
            border-radius: 12px;
            border-left: 4px solid #d4af37;
            transition: transform 0.3s;
        }

        .benefit-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .benefit-icon {
            font-size: 36px;
            display: block;
            margin-bottom: 15px;
        }

        .benefit-item h3 {
            font-family: 'Crimson Pro', serif;
            color: #2d1b4e;
            font-size: 18px;
            margin-bottom: 10px;
            margin-top: 0;
        }

        .benefit-item p {
            font-size: 14px;
            color: #666;
            margin: 0;
        }

        .cta-section {
            background: linear-gradient(135deg, #fff9e6 0%, #ffeaa7 100%);
            padding: 30px 35px;
            border-radius: 12px;
            border: 2px solid #d4af37;
            margin-top: 40px;
        }

        .cta-section h3 {
            font-family: 'Crimson Pro', serif;
            color: #2d1b4e;
            font-size: 24px;
            margin-top: 0;
            margin-bottom: 15px;
        }

        .cta-section p {
            margin-bottom: 10px;
        }

        svg {
            width: 100%;
            height: 100%;
        }

        .link {
            fill: none;
            stroke: #95a5a6;
            stroke-width: 2px;
            opacity: 0.6;
        }

        .marriage-link {
            stroke: #d4af37;
            stroke-width: 2.5px;
            stroke-dasharray: 6,4;
            opacity: 0.7;
        }

        .node circle {
            stroke: #fff;
            stroke-width: 3px;
            cursor: pointer;
            transition: all 0.3s;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .node.male circle {
            fill: #3498db;
        }

        .node.female circle {
            fill: #e74c3c;
        }

        .node.unknown circle {
            fill: #9b59b6;
        }

        .node.patriarch circle {
            fill: #d4af37;
            stroke: #2d1b4e;
            stroke-width: 4px;
        }

        .node text {
            font-size: 11px;
            pointer-events: none;
            font-weight: 500;
            fill: #2c3e50;
        }

        .node.patriarch text {
            font-family: 'Crimson Pro', serif;
            font-size: 18px;
            font-weight: 700;
            fill: #2d1b4e;
        }

        .node:hover circle {
            stroke: #d4af37;
            stroke-width: 4px;
            transform: scale(1.2);
        }

        #info-panel {
            position: absolute;
            top: 30px;
            right: 30px;
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            max-width: 350px;
            display: none;
            border-top: 4px solid #d4af37;
        }

        #info-panel.active {
            display: block;
            animation: slideIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }

        #info-panel h2 {
            font-family: 'Crimson Pro', serif;
            margin-bottom: 15px;
            color: #2d1b4e;
            font-size: 22px;
        }

        #info-panel p {
            margin: 10px 0;
            color: #555;
            line-height: 1.8;
            font-size: 14px;
        }

        #info-panel .label {
            font-weight: 600;
            color: #2d1b4e;
            display: inline-block;
            min-width: 90px;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #e74c3c;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            padding: 0;
            font-size: 18px;
            line-height: 1;
            cursor: pointer;
        }

        .close-btn:hover {
            background: #c0392b;
        }

        .legend {
            position: absolute;
            bottom: 30px;
            left: 30px;
            background: white;
            padding: 20px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border-left: 4px solid #d4af37;
        }

        .legend h3 {
            font-family: 'Crimson Pro', serif;
            margin-bottom: 15px;
            color: #2d1b4e;
            font-size: 16px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 10px 0;
        }

        .legend-color {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .controls {
            position: absolute;
            top: 30px;
            left: 30px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .zoom-btn {
            width: 50px;
            height: 50px;
            padding: 0;
            font-size: 24px;
            line-height: 1;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .search-box {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 12px 20px;
            border-radius: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .search-box input {
            border: none;
            padding: 8px 12px;
            width: 280px;
            font-size: 14px;
            background: transparent;
        }

        .search-box input:focus {
            outline: none;
        }

        #stats {
            position: absolute;
            bottom: 30px;
            right: 30px;
            background: white;
            padding: 20px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border-left: 4px solid #d4af37;
        }

        #stats .stat {
            margin: 8px 0;
            font-size: 14px;
            color: #555;
        }

        #stats .label {
            font-family: 'Crimson Pro', serif;
            font-weight: 600;
            color: #2d1b4e;
        }

        #stats .number {
            font-weight: 700;
            color: #d4af37;
            font-size: 28px;
        }
    </style>
</head>
<body>
    <!-- Animated Background Canvas -->
    <canvas id="background-canvas"></canvas>

    <!-- Password Protection Screen -->
    <div id="password-screen">
        <div class="password-container">
            <div class="password-header">
                <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                </svg>
                <h1>Chilabalika Family Tree</h1>
                <p>This family tree is password protected</p>
            </div>
            <div class="password-form">
                <input type="password" id="password-input" placeholder="Enter password" autocomplete="off">
                <button onclick="checkPassword()">Enter</button>
                <p id="password-error" class="password-error"></p>
            </div>
            <div class="password-footer">
                <p>For access, please contact a family member</p>
            </div>
        </div>
    </div>

    <!-- Welcome Screen -->
    <div id="welcome-screen" style="display: none;">
        <div class="welcome-content">
            <div class="welcome-animation">
                <h1 class="welcome-title">Welcome to the</h1>
                <h2 class="welcome-subtitle">Chilabalika Family Tree</h2>
                <p class="welcome-tagline">Three generations  One legacy</p>
                <div class="welcome-ornament">
                    <svg width="100" height="100" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="40" fill="none" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                        <circle cx="50" cy="50" r="30" fill="none" stroke="currentColor" stroke-width="2" opacity="0.5"/>
                        <circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="2" opacity="0.7"/>
                        <circle cx="50" cy="50" r="5" fill="currentColor"/>
                    </svg>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content (hidden until password correct) -->
    <div id="main-content" style="display: none;">
    <div id="container">
        <div id="nav-bar">
            <div class="nav-toggle">
                <button class="nav-btn active" onclick="showSection('home')">Home</button>
                <button class="nav-btn" onclick="showSection('about')">About</button>
                <button class="nav-btn" onclick="showSection('contact')">Contact</button>
            </div>
        </div>
        <div id="home-section" class="content-section active">
            <div id="svg-container">
                <svg id="tree-svg"></svg>
                
                <!-- Sidebar Controls -->
                <div class="sidebar-controls collapsed" id="sidebar-controls">
                    <button class="sidebar-toggle" onclick="toggleSidebar()" title="Toggle sidebar">
                        <svg class="icon-expand" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="9 18 15 12 9 6"/>
                        </svg>
                        <svg class="icon-collapse" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                            <polyline points="15 18 9 12 15 6"/>
                        </svg>
                    </button>

                    <div class="control-section">
                        <h3><span class="label-text">View Mode</span></h3>
                        <button id="tree-view-btn" class="sidebar-btn active" onclick="switchView('tree')" title="Hierarchical Tree View">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="5" r="2"/>
                                <circle cx="6" cy="12" r="2"/>
                                <circle cx="12" cy="12" r="2"/>
                                <circle cx="18" cy="12" r="2"/>
                                <circle cx="6" cy="19" r="2"/>
                                <circle cx="12" cy="19" r="2"/>
                                <circle cx="18" cy="19" r="2"/>
                                <line x1="12" y1="7" x2="12" y2="10"/>
                                <line x1="12" y1="10" x2="6" y2="10"/>
                                <line x1="12" y1="10" x2="18" y2="10"/>
                                <line x1="6" y1="14" x2="6" y2="17"/>
                                <line x1="12" y1="14" x2="12" y2="17"/>
                                <line x1="18" y1="14" x2="18" y2="17"/>
                            </svg>
                            <span class="btn-text">Tree View</span>
                        </button>
                        <button id="chart-view-btn" class="sidebar-btn" onclick="switchView('chart')" title="Traditional Chart View">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="7" height="7" rx="1"/>
                                <rect x="14" y="3" width="7" height="7" rx="1"/>
                                <rect x="3" y="14" width="7" height="7" rx="1"/>
                                <rect x="14" y="14" width="7" height="7" rx="1"/>
                                <line x1="10" y1="6" x2="14" y2="6"/>
                                <line x1="10" y1="17" x2="14" y2="17"/>
                                <line x1="6" y1="10" x2="6" y2="14"/>
                                <line x1="17" y1="10" x2="17" y2="14"/>
                            </svg>
                            <span class="btn-text">Chart View</span>
                        </button>
                    </div>

                    <div class="control-divider"></div>

                    <div class="control-section">
                        <h3><span class="label-text">Navigation</span></h3>
                        <button class="sidebar-btn" onclick="resetView()" title="Reset View">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                                <path d="M21 3v5h-5"/>
                            </svg>
                            <span class="btn-text">Reset View</span>
                        </button>
                        <button class="sidebar-btn" onclick="fitToScreen()" title="Fit to Screen">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
                            </svg>
                            <span class="btn-text">Fit to Screen</span>
                        </button>
                    </div>

                    <div class="control-divider"></div>

                    <div class="control-section">
                        <h3><span class="label-text">Zoom</span></h3>
                        <button class="sidebar-btn" onclick="zoomIn()" title="Zoom In">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="m21 21-4.35-4.35"/>
                                <line x1="11" y1="8" x2="11" y2="14"/>
                                <line x1="8" y1="11" x2="14" y2="11"/>
                            </svg>
                            <span class="btn-text">Zoom In</span>
                        </button>
                        <button class="sidebar-btn" onclick="zoomOut()" title="Zoom Out">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="m21 21-4.35-4.35"/>
                                <line x1="8" y1="11" x2="14" y2="11"/>
                            </svg>
                            <span class="btn-text">Zoom Out</span>
                        </button>
                    </div>
                </div>

                <div class="search-box">
                    <input type="text" id="search-input" placeholder="Search family member..." autocomplete="off">
                    <div id="search-suggestions" class="search-suggestions"></div>
                    <div id="search-message" class="search-message"></div>
                </div>
                <div class="legend collapsed-mobile" id="legend">
                    <button class="widget-toggle" onclick="toggleWidget('legend')" title="Toggle legend">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline class="chevron-up" points="18 15 12 9 6 15"/>
                            <polyline class="chevron-down" points="6 9 12 15 18 9" style="display: none;"/>
                        </svg>
                    </button>
                    <div class="widget-content">
                        <h3>Legend</h3>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #3498db;"></div>
                            <span>Male</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #e74c3c;"></div>
                            <span>Female</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #9b59b6;"></div>
                            <span>Unknown</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #d4af37; border-color: #2d1b4e; border-width: 3px;"></div>
                            <span>Patriarch</span>
                        </div>
                    </div>
                </div>
                <div id="stats" class="collapsed-mobile">
                    <button class="widget-toggle" onclick="toggleWidget('stats')" title="Toggle stats">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline class="chevron-up" points="18 15 12 9 6 15"/>
                            <polyline class="chevron-down" points="6 9 12 15 18 9" style="display: none;"/>
                        </svg>
                    </button>
                    <div class="widget-content">
                        <div class="stat"><span class="label">Family Members:</span> <span class="number" id="total-count">0</span></div>
                        <div class="stat"><span class="label">Generations:</span> <span class="number" id="gen-count">0</span></div>
                    </div>
                </div>
                <div id="info-panel">
                    <button class="close-btn" onclick="closeInfo()"></button>
                    <h2 id="info-name"></h2>
                    <p><span class="label">Gender:</span> <span id="info-gender"></span></p>
                    <p><span class="label">Generation:</span> <span id="info-generation"></span></p>
                    <p id="info-parent"></p>
                    <p id="info-children"></p>
                </div>
            </div>
        </div>
        <div id="about-section" class="content-section">
            <div class="page-content">
                <div class="content-card">
                    <h1>Chilabalika Family Tree</h1>
                    <p class="intro">3 Generations  Preserving our heritage and strengthening our bonds</p>
                    
                    <div class="reunion-photo">
                        <img src="reunion-photo.png" alt="Chilabalika Family Reunion in Ndola" style="width: 100%; border-radius: 16px; margin: 20px 0; box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
                        <p class="photo-caption">Our last reunion in Ndola, Zambia - December 20th, 2025</p>
                    </div>
                    
                    <div class="past-reunion-highlight">
                        <h2> Last Reunion: Ndola, Zambia</h2>
                        <p class="date-badge-past">DECEMBER 2025</p>
                        <p>We gathered together to celebrate our family heritage and strengthen our bonds across generations.</p>
                    </div>
                    
                    <div class="next-reunion-cta">
                        <h3> Join Us at the Next Reunion!</h3>
                        <p>We're planning our next family gathering. If you'd like to attend and be part of our next celebration, please get in touch!</p>
                        <button class="cta-button" onclick="showSection('contact')">Get in Touch</button>
                    </div>
                    
                    <h2>Benefits of a Family Tree</h2>
                    <div class="benefits-grid">
                        <div class="benefit-item">
                            <span class="benefit-icon"></span>
                            <h3>Keeps family history safe</h3>
                            <p>Preserving our heritage for future generations</p>
                        </div>
                        <div class="benefit-item">
                            <span class="benefit-icon"></span>
                            <h3>Helps people know who they are</h3>
                            <p>Understanding our roots and identity</p>
                        </div>
                        <div class="benefit-item">
                            <span class="benefit-icon"></span>
                            <h3>Brings families closer together</h3>
                            <p>Strengthening bonds across generations</p>
                        </div>
                        <div class="benefit-item">
                            <span class="benefit-icon"></span>
                            <h3>Protects family culture and traditions</h3>
                            <p>Maintaining our unique heritage</p>
                        </div>
                        <div class="benefit-item">
                            <span class="benefit-icon"></span>
                            <h3>Helps pass on stories and faith</h3>
                            <p>Sharing wisdom across generations</p>
                        </div>
                    </div>
                    
                    <blockquote>
                        "One generation shall commend Your works to another."  Psalm 145:4
                    </blockquote>
                    
                    <h2>Our Heritage</h2>
                    <p>The Chilabalika family tree represents the rich legacy of our patriarch, Chilabalika, and his three wives: Delile, Bina Petros, and Bina Mika. Through their union, our family has grown into a vibrant community spanning multiple generations.</p>
                    
                    <h2>Three Generations</h2>
                    <p>Our documented lineage includes:</p>
                    <ul>
                        <li><strong>Generation 1:</strong> Chilabalika and his three wives (Delile, Bina Petros, Bina Mika)</li>
                        <li><strong>Generation 2:</strong> The children of Chilabalika and Delile - Dubeka, Dina, Bina Makowa, Bina Michelo, and Bina Sibukoko - along with children from his other wives</li>
                        <li><strong>Generation 3+:</strong> Grandchildren and great-grandchildren carrying forward our legacy</li>
                    </ul>
                </div>
            </div>
        </div>
        <div id="contact-section" class="content-section">
            <div class="page-content">
                <div class="content-card">
                    <h1>Contact & Contribute</h1>
                    <p class="intro">Help us keep our family tree accurate and up-to-date. Your contributions matter!</p>
                    
                    <h2>How to Contribute</h2>
                    <p>If you have information to add or corrections to make, we welcome your input. Our family tree is a living document that grows with each generation.</p>
                    
                    <div class="contact-grid">
                        <div class="contact-card">
                            <h3> Email Updates</h3>
                            <p>Send family updates, corrections, or new information to:</p>
                            <p><strong>familytree@chilabalika.family</strong></p>
                        </div>
                        
                        <div class="contact-card">
                            <h3> Reunion Committee</h3>
                            <p>For questions about the December 20th, 2025 reunion in Ndola:</p>
                            <p><strong>reunion@chilabalika.family</strong></p>
                        </div>
                        
                        <div class="contact-card">
                            <h3> Missing Information?</h3>
                            <p>If you notice missing family members or incorrect details, please let us know. We want to ensure everyone is represented accurately.</p>
                        </div>
                        
                        <div class="contact-card">
                            <h3> Share Photos & Stories</h3>
                            <p>We're collecting family photos and stories to preserve our history. Share your memories with us!</p>
                        </div>
                    </div>
                    
                    <h2>Technical Support</h2>
                    <p>Having trouble viewing the family tree? Need help navigating the interactive features?</p>
                    <ul>
                        <li>Use the zoom buttons (+/-) to adjust your view</li>
                        <li>Click on any family member to see their details</li>
                        <li>Use the search box to find specific relatives</li>
                        <li>Switch between Tree View and Chart View for different perspectives</li>
                        <li>Click "Fit to Screen" to see the entire family at once</li>
                    </ul>
                    
                    <p class="footer-note">This interactive family tree was created with love for the Chilabalika Family Reunion 2025.</p>
                </div>
            </div>
        </div>
    </div>
    <!-- End Main Content -->

    <script>
        // Animated Background (inspired by interactive particle systems)
        const canvas = document.getElementById('background-canvas');
        const ctx = canvas.getContext('2d');
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        const particles = [];
        const isMobile = window.innerWidth <= 768;
        const particleCount = isMobile ? 40 : 80; // Reduce particles on mobile
        
        class Particle {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.vx = (Math.random() - 0.5) * 0.5;
                this.vy = (Math.random() - 0.5) * 0.5;
                this.radius = Math.random() * 2 + 1;
                this.opacity = Math.random() * 0.5 + 0.2;
            }
            
            update() {
                this.x += this.vx;
                this.y += this.vy;
                
                if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
                if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
            }
            
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
                ctx.fill();
            }
        }
        
        for (let i = 0; i < particleCount; i++) {
            particles.push(new Particle());
        }
        
        function connectParticles() {
            for (let i = 0; i < particles.length; i++) {
                for (let j = i + 1; j < particles.length; j++) {
                    const dx = particles[i].x - particles[j].x;
                    const dy = particles[i].y - particles[j].y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < 150) {
                        ctx.beginPath();
                        ctx.strokeStyle = `rgba(255, 255, 255, ${0.1 * (1 - distance / 150)})`;
                        ctx.lineWidth = 1;
                        ctx.moveTo(particles[i].x, particles[i].y);
                        ctx.lineTo(particles[j].x, particles[j].y);
                        ctx.stroke();
                    }
                }
            }
        }
        
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            particles.forEach(particle => {
                particle.update();
                particle.draw();
            });
            
            connectParticles();
            requestAnimationFrame(animate);
        }
        
        animate();
        
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
        
        // Password Protection
        const correctPassword = "Ndola2025";
        
        function checkPassword() {
            const input = document.getElementById('password-input');
            const error = document.getElementById('password-error');
            
            if (input.value === correctPassword) {
                // Correct password - show welcome screen
                const passwordScreen = document.getElementById('password-screen');
                const welcomeScreen = document.getElementById('welcome-screen');
                
                // Fade out password screen
                passwordScreen.classList.add('fade-out');
                
                setTimeout(() => {
                    passwordScreen.style.display = 'none';
                    welcomeScreen.style.display = 'flex';
                    
                    // Fade in welcome screen
                    setTimeout(() => {
                        welcomeScreen.classList.add('active');
                    }, 50);
                    
                    // After 3.5 seconds, fade to main content
                    setTimeout(() => {
                        welcomeScreen.classList.add('fade-out');
                        
                        setTimeout(() => {
                            welcomeScreen.style.display = 'none';
                            document.getElementById('main-content').style.display = 'block';
                            // Hide canvas after transition
                            setTimeout(() => {
                                canvas.style.display = 'none';
                            }, 500);
                        }, 1500);
                    }, 3500);
                }, 800);
                
                // Store in session
                sessionStorage.setItem('familyTreeAccess', 'granted');
            } else {
                // Wrong password
                error.textContent = 'Incorrect password. Please try again.';
                input.value = '';
                input.focus();
                // Shake animation
                input.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    input.style.animation = '';
                }, 500);
            }
        }
        
        // Allow Enter key to submit
        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('password-input');
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        checkPassword();
                    }
                });
                passwordInput.focus();
            }
            
            // Check if already authenticated in this session
            if (sessionStorage.getItem('familyTreeAccess') === 'granted') {
                document.getElementById('password-screen').style.display = 'none';
                document.getElementById('welcome-screen').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
                canvas.style.display = 'none';
            }
        });
        
        // Add shake animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
                20%, 40%, 60%, 80% { transform: translateX(10px); }
            }
        `;
        document.head.appendChild(style);

        // CORRECTED STRUCTURE: 3 Wives - Delile, Bina Petros, Bina Mika
        const treeData = {
            name: "Chilabalika",
            gender: "male",
            children: [
                {
                    name: "Delile (Wife 1)",
                    gender: "female",
                    isSpouse: true,
                    children: [
                        {
                            name: "Dubeka",
                            gender: "male",
                            children: [
                                {
                                    name: "Bina Musune",
                                    gender: "female",
                                    children: [
                                        { name: "Dorica", gender: "female" },
                                        { name: "Meselina", gender: "female" },
                                        { name: "Bina Munsandi", gender: "female" }
                                    ]
                                },
                                {
                                    name: "Ba Sila",
                                    gender: "male",
                                    children: [
                                        { name: "Dorothy", gender: "female" },
                                        { name: "Grey", gender: "male" },
                                        { name: "Josia", gender: "male" },
                                        { name: "Benson", gender: "male" }
                                    ]
                                },
                                {
                                    name: "Bina Majory",
                                    gender: "female",
                                    children: [
                                        { name: "Bina Flata", gender: "female" },
                                        { name: "Herbert", gender: "male" },
                                        { name: "Bina Miyanda", gender: "female" }
                                    ]
                                },
                                {
                                    name: "Bina Nziye",
                                    gender: "female",
                                    children: [
                                        { name: "Timothy", gender: "male" },
                                        { name: "Joseph", gender: "male" },
                                        { name: "Agripper", gender: "male" },
                                        { name: "Edith", gender: "female" },
                                        { name: "Hambala", gender: "unknown" },
                                        { name: "Dennis", gender: "male" },
                                        { name: "Alvin", gender: "male" }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "Dina",
                            gender: "male",
                            children: [
                                {
                                    name: "Arthur",
                                    gender: "male",
                                    children: [
                                        {
                                            name: "Winter",
                                            gender: "unknown",
                                            children: [
                                                { name: "Joy", gender: "female" },
                                                { name: "Rabbie", gender: "unknown" }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    name: "Lazarus",
                                    gender: "male",
                                    children: [
                                        { name: "Tresford", gender: "male" },
                                        { name: "Linda", gender: "female" },
                                        { name: "Bright", gender: "male" },
                                        { name: "Precious", gender: "female" }
                                    ]
                                },
                                { name: "Jolam", gender: "male" },
                                {
                                    name: "Muka Hetro",
                                    gender: "female",
                                    children: [
                                        { name: "Muyabas-Fida", gender: "unknown" }
                                    ]
                                },
                                { name: "Ba Mpasela", gender: "unknown" },
                                {
                                    name: "Ba Maxwell",
                                    gender: "male",
                                    children: [
                                        { name: "Brian Dina", gender: "male" }
                                    ]
                                },
                                {
                                    name: "Duta",
                                    gender: "unknown",
                                    children: [
                                        { name: "Aubrey", gender: "unknown" },
                                        { name: "Hambala", gender: "unknown" }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "Bina Makowa",
                            gender: "female",
                            children: [
                                { name: "Makowa", gender: "unknown" },
                                { name: "Zakaliya", gender: "male" }
                            ]
                        },
                        {
                            name: "Bina Michelo",
                            gender: "female",
                            children: [
                                { name: "Michelo", gender: "male" },
                                {
                                    name: "Elisa",
                                    gender: "female",
                                    children: [
                                        { name: "Nunu", gender: "unknown" },
                                        { name: "Perina", gender: "female" }
                                    ]
                                },
                                { name: "Muka Hamukumba", gender: "female" }
                            ]
                        },
                        {
                            name: "Bina Sibukoko",
                            gender: "female",
                            children: [
                                { name: "Elizabeth", gender: "female" },
                                { name: "Lipenga", gender: "unknown" },
                                {
                                    name: "Sibukoko",
                                    gender: "unknown",
                                    children: [
                                        { name: "Glyness", gender: "female" },
                                        { name: "Dorica", gender: "female" },
                                        { name: "Hambula", gender: "unknown" }
                                    ]
                                },
                                { name: "Muka Mwila", gender: "female" }
                            ]
                        }
                    ]
                },
                {
                    name: "Bina Petros (Wife 2)",
                    gender: "female",
                    isSpouse: true,
                    children: [
                        {
                            name: "Father to Ba Jenela",
                            gender: "male",
                            children: [
                                { name: "Ba Jenela", gender: "unknown" }
                            ]
                        },
                        {
                            name: "Mother to Dr. Oscar Kaumbi",
                            gender: "female",
                            children: [
                                { name: "Dr. Oscar Kaumbi", gender: "male" }
                            ]
                        }
                    ]
                },
                {
                    name: "Bina Mika (Wife 3)",
                    gender: "female",
                    isSpouse: true,
                    children: [
                        { name: "Bina Mika", gender: "female" },
                        {
                            name: "Mother to Ba Mika",
                            gender: "female",
                            children: [
                                { name: "Ba Mika", gender: "unknown" }
                            ]
                        },
                        {
                            name: "Father to Ba Zandala",
                            gender: "male",
                            children: [
                                { name: "Ba Zandala", gender: "unknown" }
                            ]
                        },
                        {
                            name: "Father to Euphemia",
                            gender: "male",
                            children: [
                                { name: "Euphemia", gender: "female" },
                                { name: "Firm", gender: "unknown" }
                            ]
                        }
                    ]
                }
            ]
        };

        // D3 visualization setup
        const width = window.innerWidth;
        const height = window.innerHeight - 100;
        
        const svg = d3.select("#tree-svg");
        const g = svg.append("g");

        const zoom = d3.zoom()
            .scaleExtent([0.1, 3])
            .on("zoom", (event) => {
                g.attr("transform", event.transform);
            });

        svg.call(zoom);
        
        // Enhanced touch support for mobile
        if ('ontouchstart' in window) {
            svg.on("touchstart", function(event) {
                event.preventDefault();
            });
        }

        // Create tree layout - horizontal orientation for better readability
        const treeLayout = d3.tree()
            .size([height * 1.8, width * 0.85])
            .separation((a, b) => {
                const aChildren = a.children ? a.children.length : 0;
                const bChildren = b.children ? b.children.length : 0;
                const baseSpacing = a.parent === b.parent ? 1.5 : 2.5;
                const childrenMultiplier = 1 + Math.max(aChildren, bChildren) * 0.2;
                return baseSpacing * childrenMultiplier;
            });

        // Count nodes and generations
        let nodeCount = 0;
        let maxDepth = 0;
        const root = d3.hierarchy(treeData);
        root.each(d => {
            nodeCount++;
            if (d.depth > maxDepth) maxDepth = d.depth;
        });

        document.getElementById('total-count').textContent = nodeCount;
        document.getElementById('gen-count').textContent = maxDepth + 1;

        function showInfo(node) {
            const d = node.data;
            const panel = document.getElementById("info-panel");
            document.getElementById("info-name").textContent = d.name;
            document.getElementById("info-gender").textContent = d.gender.charAt(0).toUpperCase() + d.gender.slice(1);
            document.getElementById("info-generation").textContent = node.depth;
            
            if (node.parent) {
                document.getElementById("info-parent").innerHTML = 
                    `<span class="label">Parent:</span> ${node.parent.data.name}`;
            } else {
                document.getElementById("info-parent").innerHTML = 
                    `<span class="label">Role:</span> Patriarch`;
            }
            
            if (node.children) {
                document.getElementById("info-children").innerHTML = 
                    `<span class="label">Children:</span> ${node.children.length}`;
            } else {
                document.getElementById("info-children").innerHTML = '';
            }
            
            panel.classList.add("active");
        }

        function closeInfo() {
            document.getElementById("info-panel").classList.remove("active");
        }

        function resetView() {
            svg.transition().duration(750).call(zoom.transform, d3.zoomIdentity);
        }

        function fitToScreen() {
            try {
                const bounds = g.node().getBBox();
                
                // Check if bounds are valid
                if (!bounds || bounds.width === 0 || bounds.height === 0) {
                    console.log('Invalid bounds, retrying...');
                    setTimeout(fitToScreen, 100);
                    return;
                }
                
                const fullWidth = width;
                const fullHeight = height;
                const widthScale = fullWidth / bounds.width;
                const heightScale = fullHeight / bounds.height;
                const scale = 0.9 * Math.min(widthScale, heightScale);
                const translateX = (fullWidth - bounds.width * scale) / 2 - bounds.x * scale;
                const translateY = (fullHeight - bounds.height * scale) / 2 - bounds.y * scale;
                
                svg.transition()
                    .duration(750)
                    .call(zoom.transform, d3.zoomIdentity.translate(translateX, translateY).scale(scale));
            } catch (error) {
                console.error('Error in fitToScreen:', error);
                // Retry after a delay
                setTimeout(fitToScreen, 100);
            }
        }

        function zoomIn() {
            svg.transition().duration(300).call(zoom.scaleBy, 1.3);
        }

        function zoomOut() {
            svg.transition().duration(300).call(zoom.scaleBy, 0.7);
        }

        // Search functionality with autocomplete
        let allFamilyMembers = [];
        
        function initializeSearch() {
            // Collect all family member names
            allFamilyMembers = [];
            g.selectAll(".node").each(function(d) {
                allFamilyMembers.push({
                    name: d.data.name,
                    node: d,
                    element: this
                });
            });
            
            // Set up search input listeners
            const searchInput = document.getElementById('search-input');
            searchInput.addEventListener('input', handleSearchInput);
            searchInput.addEventListener('blur', () => {
                // Delay to allow clicking suggestions
                setTimeout(() => {
                    document.getElementById('search-suggestions').classList.remove('active');
                }, 200);
            });
        }
        
        function handleSearchInput(e) {
            const query = e.target.value.toLowerCase().trim();
            const suggestionsDiv = document.getElementById('search-suggestions');
            const messageDiv = document.getElementById('search-message');
            
            // Clear previous highlights
            g.selectAll(".node").each(function(d) {
                const node = d3.select(this);
                const isPatriarch = d.data.name === "Chilabalika";
                node.select("circle")
                    .style("stroke", isPatriarch ? "#2d1b4e" : "#fff")
                    .style("stroke-width", isPatriarch ? "4px" : "3px");
                node.select("text")
                    .style("fill", "#2c3e50")
                    .style("font-weight", isPatriarch ? "700" : "500");
            });
            
            if (!query) {
                suggestionsDiv.classList.remove('active');
                messageDiv.classList.remove('active');
                suggestionsDiv.innerHTML = '';
                return;
            }
            
            // Find matches
            const matches = allFamilyMembers.filter(member => 
                member.name.toLowerCase().includes(query)
            ).slice(0, 8); // Limit to 8 results
            
            if (matches.length === 0) {
                // No results
                suggestionsDiv.classList.remove('active');
                messageDiv.textContent = 'No family members found';
                messageDiv.classList.add('active', 'no-results');
                messageDiv.classList.remove('success');
            } else {
                // Show suggestions
                messageDiv.classList.remove('active');
                suggestionsDiv.innerHTML = '';
                
                matches.forEach(match => {
                    const item = document.createElement('div');
                    item.className = 'suggestion-item';
                    
                    // Highlight matching text
                    const name = match.name;
                    const lowerName = name.toLowerCase();
                    const index = lowerName.indexOf(query);
                    
                    if (index >= 0) {
                        const before = name.substring(0, index);
                        const highlighted = name.substring(index, index + query.length);
                        const after = name.substring(index + query.length);
                        item.innerHTML = `${before}<span class="match-highlight">${highlighted}</span>${after}`;
                    } else {
                        item.textContent = name;
                    }
                    
                    item.addEventListener('click', () => selectFamilyMember(match));
                    suggestionsDiv.appendChild(item);
                });
                
                suggestionsDiv.classList.add('active');
            }
        }
        
        function selectFamilyMember(match) {
            const suggestionsDiv = document.getElementById('search-suggestions');
            const messageDiv = document.getElementById('search-message');
            const searchInput = document.getElementById('search-input');
            
            // Close suggestions
            suggestionsDiv.classList.remove('active');
            searchInput.value = match.name;
            
            // Highlight the selected member
            g.selectAll(".node").each(function(d) {
                const node = d3.select(this);
                if (d.data.name === match.name) {
                    node.select("circle")
                        .style("stroke", "#667eea")
                        .style("stroke-width", "6px");
                    node.select("text")
                        .style("fill", "#667eea")
                        .style("font-weight", "700");
                    
                    // Pan and zoom to the node
                    const x = match.node.x || 0;
                    const y = match.node.y || 0;
                    const scale = 1.5;
                    const translateX = width / 2 - x * scale;
                    const translateY = height / 2 - y * scale;
                    
                    svg.transition()
                        .duration(750)
                        .call(zoom.transform, d3.zoomIdentity.translate(translateX, translateY).scale(scale));
                    
                    // Show success message
                    messageDiv.textContent = `Found: ${match.name}`;
                    messageDiv.classList.add('active', 'success');
                    messageDiv.classList.remove('no-results');
                    setTimeout(() => {
                        messageDiv.classList.remove('active');
                    }, 2000);
                } else {
                    const isPatriarch = d.data.name === "Chilabalika";
                    node.select("circle")
                        .style("stroke", isPatriarch ? "#2d1b4e" : "#fff")
                        .style("stroke-width", isPatriarch ? "4px" : "3px");
                    node.select("text")
                        .style("fill", "#2c3e50")
                        .style("font-weight", isPatriarch ? "700" : "500");
                }
            });
        }

        // Handle resize - but don't reload on mobile (causes issues)
        let resizeTimer;
        window.addEventListener("resize", () => {
            // Skip reload on mobile devices and during orientation changes
            if (window.innerWidth <= 768) return;
            
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                // Only reload if it's a significant desktop resize
                if (window.innerWidth > 768) {
                    location.reload();
                }
            }, 500);
        });

        // View switching functionality
        let currentView = 'tree';

        function switchView(viewType) {
            if (currentView === viewType) return;
            
            currentView = viewType;
            
            // Update button states
            document.getElementById('tree-view-btn').classList.toggle('active', viewType === 'tree');
            document.getElementById('chart-view-btn').classList.toggle('active', viewType === 'chart');
            
            // Clear existing visualization
            g.selectAll("*").remove();
            
            if (viewType === 'tree') {
                drawTreeView();
            } else {
                drawChartView();
            }
            
            setTimeout(fitToScreen, 100);
        }

        function drawTreeView() {
            // Top-to-bottom traditional chart layout
            const chartLayout = d3.tree()
                .size([width * 2.5, height * 0.8])
                .separation((a, b) => {
                    const aChildren = a.children ? a.children.length : 0;
                    const bChildren = b.children ? b.children.length : 0;
                    const baseSpacing = a.parent === b.parent ? 1.2 : 2.0;
                    return baseSpacing * (1 + Math.max(aChildren, bChildren) * 0.25);
                });

            const root = d3.hierarchy(treeData);
            chartLayout(root);

            // Adjust positions for top-to-bottom flow with better spacing
            root.each(d => {
                d.x = d.x + 200;
                d.y = d.depth * 200 + 100;
            });

            drawNodes(root, 'chart');
            initializeSearch();
            
            // Multiple attempts to fit screen with increasing delays
            setTimeout(() => fitToScreen(), 50);
            setTimeout(() => fitToScreen(), 200);
            setTimeout(() => fitToScreen(), 500);
        }

        function drawChartView() {
            // Left-to-right hierarchical tree layout
            const treeLayout = d3.tree()
                .size([height * 1.8, width * 0.85])
                .separation((a, b) => {
                    const aChildren = a.children ? a.children.length : 0;
                    const bChildren = b.children ? b.children.length : 0;
                    const baseSpacing = a.parent === b.parent ? 1.5 : 2.5;
                    const childrenMultiplier = 1 + Math.max(aChildren, bChildren) * 0.2;
                    return baseSpacing * childrenMultiplier;
                });

            const root = d3.hierarchy(treeData);
            treeLayout(root);

            // Rotate tree to be left-to-right
            root.each(d => {
                const x = d.x;
                d.x = d.y + 80;
                d.y = x + 50;
            });

            drawNodes(root);
            initializeSearch();
            
            // Multiple attempts to fit screen with increasing delays
            setTimeout(() => fitToScreen(), 50);
            setTimeout(() => fitToScreen(), 200);
            setTimeout(() => fitToScreen(), 500);
        }

        function drawNodes(root, viewType = 'tree') {
            // Draw links
            g.selectAll(".link")
                .data(root.links())
                .enter()
                .append("path")
                .attr("class", d => d.target.data.isSpouse ? "link marriage-link" : "link")
                .attr("d", d => {
                    if (viewType === 'chart') {
                        // Straight vertical/horizontal lines for chart view
                        return `M${d.source.x},${d.source.y}
                                L${d.source.x},${(d.source.y + d.target.y) / 2}
                                L${d.target.x},${(d.source.y + d.target.y) / 2}
                                L${d.target.x},${d.target.y}`;
                    } else {
                        // Curved lines for tree view
                        return `M${d.source.x},${d.source.y}
                                C${(d.source.x + d.target.x) / 2},${d.source.y}
                                 ${(d.source.x + d.target.x) / 2},${d.target.y}
                                 ${d.target.x},${d.target.y}`;
                    }
                });

            // Draw nodes
            const nodes = g.selectAll(".node")
                .data(root.descendants())
                .enter()
                .append("g")
                .attr("class", d => {
                    let classes = `node ${d.data.gender}`;
                    if (d.data.name === "Chilabalika") classes += " patriarch";
                    return classes;
                })
                .attr("transform", d => `translate(${d.x},${d.y})`)
                .on("click", (event, d) => showInfo(d));

            nodes.append("circle")
                .attr("r", d => d.data.name === "Chilabalika" ? 12 : 6);

            nodes.append("text")
                .attr("dy", d => {
                    if (viewType === 'chart') {
                        return d.children ? -15 : 15;
                    } else {
                        return d.children ? -12 : 12;
                    }
                })
                .attr("dx", d => {
                    if (viewType === 'chart') {
                        return 0;
                    } else {
                        return d.children ? 0 : 10;
                    }
                })
                .style("text-anchor", d => {
                    if (viewType === 'chart') {
                        return "middle";
                    } else {
                        return d.children ? "middle" : "start";
                    }
                })
                .text(d => d.data.name.length > 28 ? d.data.name.substring(0, 25) + "..." : d.data.name);
        }

        // Initialize with tree view
        drawTreeView();

        // Sidebar toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar-controls');
            sidebar.classList.toggle('collapsed');
        }

        // Widget toggle for mobile
        function toggleWidget(widgetId) {
            const widget = document.getElementById(widgetId);
            if (widget) {
                widget.classList.toggle('collapsed-mobile');
            }
        }

        // Section navigation
        function showSection(section) {
            // Update nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.toLowerCase() === section) {
                    btn.classList.add('active');
                }
            });
            
            // Show/hide sections
            document.querySelectorAll('.content-section').forEach(sec => {
                sec.classList.remove('active');
            });
            document.getElementById(section + '-section').classList.add('active');
        }
    </script>
</body>
</html>
